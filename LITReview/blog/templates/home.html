{% extends "base.html" %}

{% block body_class %}page-home{% endblock %}

{% block content %}
<div class="home-buttons-container">
    <form action="{% url 'ticket_create' %}" method="get" style="display:inline;">
        <button type="submit" class="home-btn big-home-btn">Demander une critique</button>
    </form>
    <form action="{% url 'review_create' %}" method="get" style="display:inline;">
    <button type="submit" class="home-btn big-home-btn">Créer une critique</button>
</form>
</div>

<div class="posts-list">
    {% for post in posts %}
    <div class="post-encadre">
        <div class="post-top-row">
            <span class="post-type">
                {% if post.post_type == 'ticket' %}
                    Vous avez publié un ticket
                {% else %}
                    Vous avez publié une critique
                {% endif %}
            </span>
            <span class="post-date">{{ post.time_created|date:"H:i, d F Y" }}</span>
        </div>

        <div class="post-title">
            {% if post.post_type == 'ticket' %}
                {{ post.title }}
            {% else %}
                {{ post.ticket.title }}
            {% endif %}
        </div>

        <div class="post-desc">
            {% if post.post_type == 'ticket' %}
                {{ post.description }}
            {% else %}
                <em>{{ post.headline }}</em><br>{{ post.body }}
            {% endif %}
        </div>

        {% if post.post_type == 'ticket' and post.image %}
        <div class="post-image">
            <img src="{{ post.image.url }}" alt="Image billet" class="ticket-image" />
        </div>
        {% elif post.post_type == 'review' and post.ticket.image %}
        <div class="post-image">
            <img src="{{ post.ticket.image.url }}" alt="Image billet" class="ticket-image" />
        </div>
        {% endif %}

        <div class="post-actions-row">
            {% if post.post_type == 'ticket' %}
                <a href="{% url 'ticket_update' post.pk %}" class="ticket-btn">Modifier</a>
                <form action="{% url 'ticket_delete' post.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="ticket-btn" onclick="return confirm('Es-tu sûr de vouloir supprimer ce post ?');">Supprimer</button>
                </form>
            {% else %}
                <a href="{% url 'review_update' post.pk %}" class="ticket-btn">Modifier</a>
                <form action="{% url 'review_delete' post.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="ticket-btn" onclick="return confirm('Es-tu sûr de vouloir supprimer ce post ?');">Supprimer</button>
                </form>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p>Aucun post trouvé.</p>
    {% endfor %}
</div>
{% endblock %}
