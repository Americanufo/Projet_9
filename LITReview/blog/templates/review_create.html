{% extends "base.html" %}

{% block content %}
<h2>Cr√©er une critique</h2>
<div>
    {% if ticket %}
        <h1>{{ ticket.title }}</h1>
    <p>Par {{ ticket.user }} le {{ ticket.time_created|date:"d/m/Y H:i" }}</p>
    {% if ticket.image %}
        <img src="{{ ticket.image.url }}" alt="Image pour {{ ticket.title }}" class="ticket-image" />
    {% endif %}
    <p>{{ ticket.description }}</p>

    <hr>

    <h2>Commentaires</h2>
    <ul class="review-list">
        {% for review in reviews %}
        <li class="review-item">
            <strong>{{ review.headline }}</strong> - note : {{ review.rating }}/5<br />
            <p>{{ review.body }}</p>
            <p>Par {{ review.user }} le {{ review.time_created|date:"d/m/Y H:i" }}</p>
            {% if review.user == request.user %}
                <a href="{% url 'review_update' review.pk %}">Modifier</a> |
                <form action="{% url 'review_delete' review.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('Confirmez-vous la suppression ?');">Supprimer</button>
                </form>
            {% endif %}
        </li>
        {% empty %}
        <li>Pas encore de commentaires.</li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <fieldset class="form-section">
            <legend>Livre / Article</legend>
            <div class="form-group">
                {{ ticket_form.title.label_tag }}
                {{ ticket_form.title }}
            </div>
            <div class="form-group">
                {{ ticket_form.description.label_tag }}
                {{ ticket_form.description }}
            </div>
            <div class="form-group">
                {{ ticket_form.image.label_tag }}
                {{ ticket_form.image }}
            </div>
        </fieldset>

        <fieldset class="form-section">
            <legend>Critique</legend>
            <div class="form-group">
                {{ review_form.headline.label_tag }}
                {{ review_form.headline }}
            </div>
            <div class="form-group rating">
                {{ review_form.rating.label_tag }}
                {{ review_form.rating }}
            </div>
            <div class="form-group">
                {{ review_form.body.label_tag }}
                {{ review_form.body }}
            </div>
        </fieldset>

        <div class="form-actions">
            <button type="submit" class="submit-btn">Envoyer</button>
        </div>
    </form>
</div>
{% endblock %}
